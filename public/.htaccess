<IfModule mod_rewrite.c>
    # Rachie Framework - Request Router
    # Routes all requests through index.php except actual files (CSS, JS, images)
    # Note: We only check for files (!-f), NOT directories (!-d).
    # This ensures routes like /admin work even if public/admin/ directory exists.

    RewriteEngine On

    # If request is not for an actual file (CSS, JS, image, etc)
    RewriteCond %{REQUEST_FILENAME} !-f

    # Route everything else through index.php
    RewriteRule ^(.*)$ index.php?_rachie_route=$1 [QSA,L]
</IfModule>

# Prevent directory listing
Options -Indexes

# Deny access to hidden files (starting with .)
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Block all PHP and executable files EXCEPT index.php and server.php
<FilesMatch "^(?!(index|server)\.php$).*\.(php|phtml|php3|php4|php5|php7|phps|pht|phar|pl|py|jsp|asp|sh|cgi)$">
    Require all denied
</FilesMatch>

# Block sensitive config and system files
<FilesMatch "\.(htaccess|htpasswd|ini|conf|config|log|sql|bak)$">
    Require all denied
</FilesMatch>